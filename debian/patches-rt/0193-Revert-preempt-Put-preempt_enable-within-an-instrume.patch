From 265c0055d1dad63a9383aa6a460b21e1fcc2c90e Mon Sep 17 00:00:00 2001
From: Clark Williams <clark.williams@gmail.com>
Date: Tue, 6 Feb 2024 12:17:19 -0600
Subject: [PATCH 193/198] Revert "preempt: Put preempt_enable() within an
 instrumentation*() section."
Origin: https://www.kernel.org/pub/linux/kernel/projects/rt/6.6/older/patches-6.6.25-rt29.tar.xz

This reverts commit cc3d27d9fdeddcb82db3ea176a44a5509e70eb1c.

This code was fixed in 6.6 stable so no need for it in the RT series

Reported-by: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
Signed-off-by: Clark Williams <williams@redhat.com>
---
 include/linux/preempt.h | 10 ++--------
 1 file changed, 2 insertions(+), 8 deletions(-)

--- a/include/linux/preempt.h
+++ b/include/linux/preempt.h
@@ -230,21 +230,15 @@
 #define preempt_enable() \
 do { \
 	barrier(); \
-	if (unlikely(preempt_count_dec_and_test())) { \
-		instrumentation_begin(); \
+	if (unlikely(preempt_count_dec_and_test())) \
 		__preempt_schedule(); \
-		instrumentation_end(); \
-	} \
 } while (0)
 
 #define preempt_enable_notrace() \
 do { \
 	barrier(); \
-	if (unlikely(__preempt_count_dec_and_test())) { \
-		instrumentation_begin(); \
+	if (unlikely(__preempt_count_dec_and_test())) \
 		__preempt_schedule_notrace(); \
-		instrumentation_end(); \
-	} \
 } while (0)
 
 #define preempt_check_resched() \
